
@{
    ViewBag.Title = "DisplayChart";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>Rating Chart</h2>


<div id="chart" class="col-lg-6"></div>

<script src="https://d3js.org/d3.v5.min.js"></script>
<script>
    // 使用AJAX从你的服务器获取数据
    fetch('/Rating/RatingChart')
        .then(response => response.json())
        .then(data => {
            drawBarChart(data);
        })
        .catch(error => console.error('Error fetching the data:', error));

    function drawBarChart(data) {
        // 设置图表尺寸和边距
        const width = 800;
        const height = 400;
        const margin = { top: 20, right: 20, bottom: 300, left: 50 };

        // 创建SVG元素
        const svg = d3.select("#chart")
            .append("svg")
            .attr("width", width + margin.left + margin.right)

            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform", `translate(${margin.left},${margin.top})`);

        // 创建x和y比例尺
        const x = d3.scaleBand()
            .range([0, width])
            .domain(data.map(d => d.FullName))
            .padding(0.5);

        const y = d3.scaleLinear()
            .range([height, 0])
            .domain([0, d3.max(data, d => d.Score)]);

        // 添加x轴和y轴
        svg.append("g")
            .attr("transform", `translate(0,${height})`)
            .call(d3.axisBottom(x))
            .selectAll("text")
            .attr("transform", "rotate(-45)")
            .style("text-anchor", "end");

        svg.append("g")
            .call(d3.axisLeft(y));

        // 添加条形到图表
        svg.selectAll(".bar")
            .data(data)
            .enter()
            .append("rect")
            .attr("class", "bar")
            .attr("x", d => x(d.FullName))
            .attr("y", d => y(d.Score))
            .attr("width", x.bandwidth())
            .attr("height", d => height - y(d.Score))
            .attr("fill", "#69b3a2"); // 可以选择你喜欢的颜色
    }
</script>


