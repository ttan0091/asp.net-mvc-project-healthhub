@*@model List<HealthHub2.Models.AppointmentViewModel>*@
@model PagedList.IPagedList<HealthHub2.Models.AppointmentViewModel>

@using PagedList.Mvc;
@{
    ViewBag.Title = "CheckImages";
    Layout = "~/Views/Shared/_Layout.cshtml";
}


<div class="row align-items-end">
    <div class="col-md-4">
        <h2>Appointment Details</h2>
    </div>
    <div class="col-md-8 text-start">
        <a href="@Url.Action("Index", "Mri")" class="align-bottom">Back</a>
    </div>
</div>






@if (Model.Count == 0)
{
    <div class="alert alert-info mt-5">
        <strong>No medical images found.</strong>
    </div>
}
else
{
<div class="row">
    <div class="short-box clearfix col-lg-6 col-md-12 mt-3 ">
        <div class="select-box">
            <select class="wide" id="sortOrderSelect" data-display="@ViewBag.CurrentSort">
                <option data-display="Sort by">Sort by</option>
                <option value="@Url.Action("CheckImages", new { sortOrder = "date_desc" })">Appointment Date Descending</option>
                <option value="@Url.Action("CheckImages", new { sortOrder = "date_asc" })">Appointment Date Ascending</option>
            </select>
        </div>
    </div>

    <div class="col-lg-6 col-md-12 mt-3">
        <!-- 分页控件 -->
        <nav aria-label="Page navigation">
            <ul class="pagination">
                <!-- Previous Page Link -->
                <li class="page-item @(Model.HasPreviousPage ? "" : "disabled")">
                    <a class="page-link" href="@Url.Action("CheckImages", new { sortOrder = ViewBag.CurrentSort, page = Model.PageNumber - 1 })" aria-label="Previous">
                        <span aria-hidden="true">Previous</span>
                    </a>
                </li>

                <!-- Individual Page Links -->
                @for (var i = 1; i <= Model.PageCount; i++)
                {
                    <li class="page-item @(i == Model.PageNumber ? "active" : "")">
                        <a class="page-link" href="@Url.Action("CheckImages", new { sortOrder = ViewBag.CurrentSort, page = i })">@i</a>
                    </li>
                }

                <!-- Next Page Link -->
                <li class="page-item @(Model.HasNextPage ? "" : "disabled")">
                    <a class="page-link" href="@Url.Action("CheckImages", new { sortOrder = ViewBag.CurrentSort, page = Model.PageNumber + 1 })" aria-label="Next">
                        <span aria-hidden="true">Next</span>
                    </a>
                </li>
            </ul>
        </nav>

    </div>
</div>

        <table class="table table-striped fs-6 mt-3 shadow">
            <thead>
                <tr>
                    <th>Appointment Date</th>
                    <th>Service Type</th>
                    <th>Clinic Name</th>
                    <th>Doctor Name</th>
                    <th>Status</th>
                    <th>Upload Date</th>
                    <th>Medical Image</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    <tr>
                        <td>@item.Date.ToString("yyyy-MM-dd")</td>
                        <td>@Html.DisplayFor(modelItem => item.ServiceType)</td>
                        <td>@Html.DisplayFor(modelItem => item.ClinicName)</td>
                        <td>@Html.DisplayFor(modelItem => item.DoctorName)</td>
                        <td>@Html.DisplayFor(modelItem => item.Status)</td>
                        <td>@Html.DisplayFor(modelItem => item.UploadDate)</td>
                        <td><img src="@item.ImageUrl" alt="Medical Image" width="100" height="100"></td>
                    </tr>
                }
            </tbody>
        </table>
        }

        @Scripts.Render("~/bundles/jquery")
        <script>
            //$(document).ready(function () {
            //    $('#sortOrderSelect').on('change', function () {
            //        //console.log("Change event triggered with jQuery");
            //        //console.log("Changed value:", this.value);
            //        window.location.href = this.value;
            //    });
            //});

            $(document).ready(function () {
                // 检查 localStorage 是否包含保存的排序方式
                const savedSortOrder = localStorage.getItem('sortOrder');
                if (savedSortOrder) {
                    // 更新 data-display 属性
                    $('#sortOrderSelect').attr('data-display', savedSortOrder);
                }

                $('#sortOrderSelect').on('change', function () {
                    // 获取被选中选项的文本
                    const selectedText = $(this).find("option:selected").text();

                    // 更新 localStorage
                    localStorage.setItem('sortOrder', selectedText);

                    // 更新数据显示和导航
                    window.location.href = this.value;
                });
            });
        </script>
